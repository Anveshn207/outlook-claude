# Kurweball — Context Summary

## Session Summary
- **Date**: 2026-02-13 (morning session — Landing Page + RBAC Fix + Roles Page + E2E Testing)
- **Project**: Kurweball — Unified Recruiting Platform (ATS + CRM)
- **Location**: `C:\Outlook Claude\Kurweball`

### Accomplished This Session

1. **Landing Page** — Built modern dark-themed landing page at `/` with:
   - Animated gradient blobs, mouse-following glow, noise texture overlay
   - Hero section ("Hire smarter, not harder"), stats with scroll-triggered animated counters
   - 6 feature cards with hover glow, 3-step "How it works" flow
   - RBAC showcase section, final CTA, sticky frosted-glass nav, footer
   - CSS animations in globals.css (landing-blob-float, landing-fade-up)

2. **CRITICAL BUG FIX — RBAC Guard Ordering** — Fixed 403 errors on ALL dashboard API calls:
   - **Root cause**: `RolesGuard` (APP_GUARD) ran before `JwtAuthGuard` (per-controller), so `request.user` was undefined when permissions were checked
   - **Fix**: Registered `JwtAuthGuard` as APP_GUARD (before RolesGuard) with `@Public()` decorator for unauthenticated routes
   - Created `@Public()` decorator at `apps/api/src/modules/auth/decorators/public.decorator.ts`
   - Updated `JwtAuthGuard` to check for `@Public()` and skip auth
   - Added `@Public()` to: auth/register, auth/register-with-invite, auth/login, auth/refresh, health controller, invites/validate/:token
   - Registered guard order in app.module.ts: JwtAuthGuard → RolesGuard → ThrottlerGuard

3. **Roles & Permissions Page** — New page at `/roles` with:
   - 4 role cards (Admin/Manager/Recruiter/Viewer) with permission counts + progress bars
   - Full permission matrix table (16 modules, 48 permissions)
   - Expandable rows showing individual permissions with green check / gray X per role
   - Added to sidebar navigation with ShieldCheck icon

4. **Admin User Update** — Changed name from "Admin Smith" to "Anvesh N"

5. **E2E Testing** — Full Playwright test suite (22 tests, 19 passed):
   - Auth flow: login, logout, protected route redirect — all pass
   - All 13 pages load correctly with real data
   - CRUD flows: create candidates, jobs, clients — all work
   - 3 search test "failures" were test script issues (readonly navbar input), not app bugs
   - 20 screenshots captured in `e2e-screenshots/`

### What Needs to Be Done Next (Prioritized)
1. **Deploy to Hetzner** — SSH port still firewalled (65.108.218.222). Need IP whitelist.
2. **Clean up per-controller @UseGuards(JwtAuthGuard)** — Now redundant since it's a global APP_GUARD. Low priority but good hygiene.
3. **SSE reconnection in headless** — NotificationStream errors in Playwright (cosmetic, SSE works fine in real browsers)

### Key Decisions
- JwtAuthGuard as APP_GUARD with @Public() decorator (standard NestJS pattern)
- Landing page as client component with CSS animations (no heavy JS animation libs)
- Roles page is read-only display (permissions defined in code, not configurable via UI)

## Technical State

### Files Created This Session
- `apps/web/src/app/page.tsx` — Landing page (replaced redirect)
- `apps/web/src/app/(dashboard)/roles/page.tsx` — Roles & Permissions page
- `apps/api/src/modules/auth/decorators/public.decorator.ts` — @Public() decorator
- `e2e-test.ts` — Playwright E2E test script
- `e2e-screenshots/` — 20 test screenshots

### Files Modified This Session
- `apps/web/src/app/globals.css` — Added landing page animations
- `apps/web/src/components/layout/sidebar.tsx` — Added Roles nav item
- `apps/api/src/modules/auth/guards/jwt-auth.guard.ts` — Added @Public() support + Reflector
- `apps/api/src/modules/auth/auth.controller.ts` — Added @Public() to login/register/refresh
- `apps/api/src/modules/health/health.controller.ts` — Added @Public()
- `apps/api/src/modules/invites/invites.controller.ts` — Added @Public() to validate/:token
- `apps/api/src/app.module.ts` — Registered JwtAuthGuard as first APP_GUARD

### Build Status
- Frontend: CLEAN (zero TS errors)
- API: CLEAN (starts successfully, all routes mapped)
- E2E: 19/22 passing (3 are test-script targeting issues)

### Running Services
- API: `cd apps/api && node --require @swc-node/register src/main.ts` (port 3001)
- Frontend: `cd apps/web && npm run dev` (port 3000)
- Login: admin@acme.com / password123 (user: Anvesh N, role: ADMIN)

## Resume Instructions
1. Read this file + `memory/kurweball-progress.md`
2. Both servers may need restarting (API on 3001, frontend on 3000)
3. Priority: Deploy when SSH access is available
4. Optional cleanup: remove per-controller @UseGuards(JwtAuthGuard) from all controllers (now handled by APP_GUARD)
5. Verify builds: `npx tsc --noEmit` in both apps/api and apps/web
