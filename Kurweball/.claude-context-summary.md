# KurweBall — Context Summary

## Session Summary
- **Date**: 2026-02-19
- **Project**: KurweBall — Unified Recruiting Platform (ATS + CRM)
- **Location**: `C:\Outlook Claude\Kurweball`
- **Branch**: master

### Accomplished This Session
1. **Admin-only task deletion** — Added trash icon delete button to Tasks page, restricted `tasks:delete` permission to ADMIN role only (removed from RECRUITER and MANAGER in both backend `apps/api/src/modules/auth/rbac/permissions.ts` and frontend `apps/web/src/lib/permissions.ts`)

2. **Smart auto-import system** — Major enhancement to the file import feature:
   - Added 40+ field aliases/synonyms to `ai-mapping.service.ts` for common recruiting column names
   - Data pattern detection: analyzes sample values to auto-detect emails, phones, LinkedIn URLs
   - Auto-skip metadata columns (Created By, Created On, Created date)
   - Duplicate field prevention (tracks used fields)
   - Frontend auto-advance: wizard skips from Upload to Preview when confidence >= 0.7
   - Fixed SKIP bug: backend's "SKIP" values now properly converted to empty strings
   - Auto-mapped indicator: blue Sparkles banner on preview step

3. **New Candidate fields** — Added 4 fields + virtual fullName:
   - `applicantId` (String?) — External ID
   - `state` (String?) — State/Province
   - `dateOfBirth` (DateTime?) — DOB
   - `resumeAvailable` (String?) — Resume availability
   - `fullName` (virtual) — Auto-splits into firstName + lastName during import
   - Migration: `20260219165704_add_candidate_import_fields`

4. **Airtable data extraction** — Combined 7 export files (3,335 applicants) into Excel
5. **Bench sales Excel** — Filtered 627 bench candidates (H1B, OPT-EAD, GC-EAD, EAD) → `bench-sales-data.xlsx`

### Key Files Modified
- `apps/api/prisma/schema.prisma` — 4 new Candidate fields
- `apps/api/src/modules/auth/rbac/permissions.ts` — tasks:delete admin-only
- `apps/api/src/modules/import-export/ai-mapping.service.ts` — aliases, patterns, auto-skip
- `apps/api/src/modules/import-export/import.service.ts` — fullName split, date coercion
- `apps/api/src/modules/import-export/types/import.types.ts` — new fields, date type, virtual flag
- `apps/web/src/lib/permissions.ts` — tasks:delete removed from RECRUITER
- `apps/web/src/app/(dashboard)/tasks/page.tsx` — delete button (admin-only)
- `apps/web/src/components/shared/import-dialog.tsx` — auto-advance, SKIP fix, autoMapped state

### What Needs To Be Done Next
1. Test import with bench-sales-data.xlsx to verify auto-mapping end-to-end
2. Update candidate detail/edit pages to show new fields (applicantId, state, dateOfBirth, resumeAvailable)
3. Update candidate export to include new fields
4. Clean up temp files (filter-bench.js, create-bench-excel.js, list-windows.ps1)
5. Deploy to Hetzner (65.108.218.222 — SSH port firewalled)

### Database Users
| Name | Email | Password | Role |
|------|-------|----------|------|
| Anvesh N | anvesh.n@engineeringsquare.us | Admin123$ | ADMIN |
| Mounica A (Hr) | Hr@engineeringsquare.us | Test1234$ | MANAGER |
| Saikumar | saikumar@engineeringsquare.us | Test1234$ | MANAGER |
| Sarah Johnson | sarah@acme.com | password123 | RECRUITER |
| Mike Davis | mike@acme.com | password123 | RECRUITER |

## Resume Instructions
1. Read this file + `memory/MEMORY.md`
2. Start API: `cd apps/api && node --require @swc-node/register src/main.ts`
3. Start frontend: `cd apps/web && npm run dev`
4. Test import at http://localhost:3000/import with bench-sales-data.xlsx
5. Next: update candidate detail page for new fields, then deploy
