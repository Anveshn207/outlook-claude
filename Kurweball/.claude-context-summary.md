# KurweBall — Context Summary

## Session Summary
- **Date**: 2026-02-13 (~3:30 PM - 8:10 PM)
- **Project**: KurweBall — Unified Recruiting Platform (ATS + CRM)
- **Location**: `C:\Outlook Claude\Kurweball`
- **Branch**: master, latest commit: `4d4c387`

### Accomplished This Session
1. **Admin Credentials Fix**: Updated admin user in DB and seed.ts to use anvesh.n@engineeringsquare.us / Admin123$ (was reset to seed defaults)

2. **Invite System**: Created invites for saikumar@engineeringsquare.us (MANAGER) and Hr@engineeringsquare.us (MANAGER). Both registered successfully. Reset Hr password to Test1234$.

3. **Token Auto-Refresh** (apps/web/src/lib/api.ts + auth-store.ts):
   - Added `tryRefreshToken()` singleton that calls POST /auth/refresh
   - apiFetch: on 401, tries refresh before logging out (prevents 15-min session timeout)
   - hydrate(): tries refresh if /auth/me returns 401

4. **LAN Access** (apps/api/src/main.ts + apps/web/package.json):
   - API listens on `0.0.0.0:3001` (was localhost only)
   - Frontend: `next dev --hostname 0.0.0.0`
   - Added `http://192.168.1.153:3000` to CORS origins
   - Opened Windows Firewall ports 3000, 3001
   - Changed network from Public to Private
   - Set up cloudflared tunnel for external access

5. **Case-Insensitive Email Login** (apps/api/src/modules/auth/auth.service.ts):
   - Changed `findFirst({ where: { email: dto.email } })` to `{ email: { equals: dto.email, mode: 'insensitive' } }`
   - This was the root cause of "Unauthorized" on other laptops (typing lowercase email)

6. **Fixed Error Message Swallowing** (apps/web/src/lib/api.ts):
   - Removed hardcoded `throw new ApiError(401, "Unauthorized")` for auth paths
   - Now shows actual API error message (e.g., "Invalid email or password")

### Key Files Modified
- `apps/api/prisma/seed.ts` — Admin credentials (anvesh.n@engineeringsquare.us / Admin123$)
- `apps/api/src/main.ts` — Listen on 0.0.0.0, CORS for LAN IP
- `apps/api/src/modules/auth/auth.service.ts` — Case-insensitive email login
- `apps/web/package.json` — --hostname 0.0.0.0
- `apps/web/src/lib/api.ts` — Token auto-refresh, proper error messages
- `apps/web/src/stores/auth-store.ts` — Token refresh in hydrate()

### Running Services
- API: port 3001 (background task b68e63f)
- Frontend: port 3000 (background task bb60133)
- Cloudflare tunnel: chest-tied-spider-straight.trycloudflare.com (task b6a6916, temporary)

### Database Users
| Name | Email | Password | Role |
|------|-------|----------|------|
| Anvesh N | anvesh.n@engineeringsquare.us | Admin123$ | ADMIN |
| Mounica A (Hr) | Hr@engineeringsquare.us | Test1234$ | MANAGER |
| Saikumar | saikumar@engineeringsquare.us | Test1234$ | MANAGER |
| Sarah Johnson | sarah@acme.com | password123 | RECRUITER |
| Mike Davis | mike@acme.com | password123 | RECRUITER |

### Git Status
- Branch: master, commit `4d4c387`, pushed to origin
- All changes committed

## Resume Instructions
1. Read this file + `memory/MEMORY.md`
2. Start API: `cd apps/api && node --require @swc-node/register src/main.ts`
3. Start frontend: `cd Kurweball && npm run dev -w web`
4. For external access: `"C:\Program Files (x86)\cloudflared\cloudflared.exe" tunnel --url http://localhost:3000`
5. Both servers bind to 0.0.0.0 — accessible on LAN at 192.168.1.153
