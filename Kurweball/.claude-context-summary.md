# KurweBall — Context Summary

## Session Summary
- **Date**: 2026-02-13 (afternoon session — Admin Email + API Proxy + Fixes)
- **Project**: KurweBall — Unified Recruiting Platform (ATS + CRM)
- **Location**: `C:\Outlook Claude\Kurweball`

### Accomplished This Session

1. **Admin Email Change Feature** — Enabled admins to change their login email:
   - Added `email` field with `@IsEmail()` to `UpdateUserDto`
   - Added email update logic in `users.service.ts` with duplicate check (`ConflictException`)
   - Made email field editable for admins in Account > Contact Info tab
   - Non-admins still see read-only email

2. **Fixed Transparent Dropdown** — Added `--color-popover` and `--color-popover-foreground` CSS variables for both light (#ffffff) and dark (#12121e) modes in globals.css

3. **API Proxy for Tunnel Access** — Fixed "unable to reach server" when accessing via Cloudflare tunnel:
   - Added Next.js rewrites in `next.config.ts` to proxy `/api/*` → `http://localhost:3001/api/*`
   - Changed all 7 files with hardcoded `localhost:3001/api` fallback to relative `/api`
   - Files updated: api.ts, auth-store.ts, use-notification-stream.ts, export-dropdown.tsx, import-dialog.tsx, candidates/[id]/page.tsx, reports/page.tsx

4. **Cloudflare Tunnel** — Restarted tunnel, current URL: `https://flows-mae-slip-summary.trycloudflare.com`

5. **Invite System** — Created invite for saikumar@engineeringsquare.us (RECRUITER role):
   - Token: `b626e60e2a358746910b4fd2182cd5ee6ac605a92de4d8d085f993f22528176c`
   - Register URL: `https://flows-mae-slip-summary.trycloudflare.com/register?token=b626e60e2a358746910b4fd2182cd5ee6ac605a92de4d8d085f993f22528176c`
   - Open registration is disabled (only first user can self-register, others need invite)

### Key Decisions
- API proxy via Next.js rewrites (not a second tunnel) — simpler, single URL for everything
- Relative `/api` path as default (not localhost) — works both locally and via tunnel
- Admin email is now `anvesh.n@engineeringsquare.us` (was admin@acme.com)
- Admin password: `Admin123$`

## Technical State

### Files Modified This Session
- `apps/api/src/modules/users/dto/update-user.dto.ts` — Added email field
- `apps/api/src/modules/users/users.service.ts` — Email update with duplicate check
- `apps/web/src/app/(dashboard)/account/page.tsx` — Editable email for admins
- `apps/web/src/app/globals.css` — Added popover color variables
- `apps/web/next.config.ts` — Added API rewrite proxy
- `apps/web/src/lib/api.ts` — Changed fallback to /api
- `apps/web/src/stores/auth-store.ts` — Changed fallback to /api
- `apps/web/src/hooks/use-notification-stream.ts` — Changed fallback to /api
- `apps/web/src/components/shared/export-dropdown.tsx` — Changed fallback to /api
- `apps/web/src/components/shared/import-dialog.tsx` — Changed fallback to /api
- `apps/web/src/app/(dashboard)/candidates/[id]/page.tsx` — Changed fallback to /api
- `apps/web/src/app/(dashboard)/reports/page.tsx` — Changed fallback to /api

### Untracked Files (from prior sessions, not yet committed)
- `apps/web/src/app/(dashboard)/account/page.tsx`
- `apps/web/src/components/ui/avatar.tsx`
- `apps/web/src/components/ui/tabs.tsx`

### Build Status
- Frontend: CLEAN (zero TS errors)
- API: CLEAN (pre-existing import-export TS errors only)
- Git: master branch, latest commit `67d18cd`, pushed to origin

### Running Services
- API: `node --require @swc-node/register src/main.ts` (port 3001, background task b90bbb3)
- Frontend: `npm run dev` (port 3000, background task bc8c04e)
- Cloudflare tunnel: running (background task b9bdefa), URL: flows-mae-slip-summary.trycloudflare.com
- Login: anvesh.n@engineeringsquare.us / Admin123$

## Resume Instructions
1. Read this file + `memory/MEMORY.md`
2. Both servers should be running (API on 3001, frontend on 3000). Restart if needed.
3. Tunnel URL changes on restart: `"C:\Program Files (x86)\cloudflared\cloudflared.exe" tunnel --url http://localhost:3000`
4. The 3 untracked files (account page, avatar, tabs) still need committing
5. Priority: Deploy to Hetzner when SSH access is available
6. Verify builds: `npx tsc --noEmit` in apps/web
7. Registration requires invite links — open registration disabled after first user
