# Kurweball — Context Summary

## Session Summary
- **Date**: 2026-02-11 (latest session)
- **Project**: Kurweball — Unified Recruiting Platform (ATS + CRM + Airtable-lite)
- **Location**: `C:\Outlook Claude\Kurweball`

### Accomplished (Sprints 1-5 — COMPLETE in prior sessions)
- Full monorepo: Next.js 15 frontend + NestJS API + PostgreSQL + Prisma + Tailwind + shadcn/ui
- 13 API modules, 15+ routes, ~130 files
- Candidates, Jobs, Clients, Submissions, Pipeline, Interviews, Activities, Tasks, Reports, Search, Resumes

### Accomplished (Sprint 6 — COMPLETE this session)
- **Custom Fields API Module**: CRUD for custom field definitions (10 field types: TEXT, NUMBER, DATE, SELECT, MULTI_SELECT, CHECKBOX, URL, EMAIL, PHONE, CURRENCY). Tenant-scoped, filterable by entityType.
- **Saved Views API Module**: CRUD for saved view configurations with default view management.
- **Settings Page Rewrite**: Replaced hardcoded data with full API-driven CRUD. Entity type filter, Add/Edit dialog with auto-slugify, options editor for SELECT types, delete with confirmation.
- **Custom Field Renderer Components**: `useCustomFields` hook, `CustomFieldInput` (form input), `CustomFieldDisplay` (read-only display). All 10 field types supported.
- **Wired Custom Fields into Create Forms**: Candidates, Jobs, Clients create dialogs now have dynamic custom fields section.
- **Wired Custom Fields into Detail Pages + Tables**: Candidate, Job, Client detail pages show Custom Fields card. List pages show dynamic columns for `isVisibleInList` fields.
- **Seed Data**: 9 custom fields (5 candidate, 2 job, 2 client) + 3 saved views.
- **CORS Fix**: Updated `apps/api/src/main.ts` to accept multiple dev ports (3000-3002). Fixed `.env` FRONTEND_URL to port 3002.
- **Client Detail Bug Fix**: Fixed `Cannot read properties of undefined (reading 'jobs')` — used `client.jobs?.length` instead of `client._count.jobs`.
- **Screenshots**: Captured all 12 main pages with Playwright (login, dashboard, candidates, jobs, clients, pipeline, tasks, reports, settings, candidate-detail, job-detail, client-detail).

### In Progress
- Nothing partially done — Sprint 6 is 100% complete + bug fix applied

### Next Steps
1. Commit the client detail bug fix + screenshot scripts
2. Consider Sprint 7 features (email integration, notifications, bulk actions, advanced search/filters)
3. The `_count` field on client list vs detail responses could be harmonized in the API

### Key Decisions
- Custom fields stored in `customData Json` column on entities (no schema migration needed per field)
- Custom field definitions in `CustomField` Prisma model with tenant scoping
- CORS accepts array of origins as fallback when `FRONTEND_URL` env is not set
- Playwright screenshots use direct API token injection into localStorage (bypasses form login)

### Bugs Fixed This Session
- **Client Detail crash**: `client._count.jobs` was undefined because detail API returns full `jobs[]` array, not `_count`. Fixed to use `client.jobs?.length`.
- **CORS blocking**: API had `Access-Control-Allow-Origin: http://localhost:3000` but frontend ran on port 3002. Fixed by updating `.env` `FRONTEND_URL` to port 3002.

## Technical State

### Files Created This Session (Sprint 6)
**API - Custom Fields (6 files)**:
- `apps/api/src/modules/custom-fields/custom-fields.module.ts`
- `apps/api/src/modules/custom-fields/custom-fields.service.ts`
- `apps/api/src/modules/custom-fields/custom-fields.controller.ts`
- `apps/api/src/modules/custom-fields/dto/create-custom-field.dto.ts`
- `apps/api/src/modules/custom-fields/dto/update-custom-field.dto.ts`
- `apps/api/src/modules/custom-fields/dto/query-custom-fields.dto.ts`

**API - Saved Views (6 files)**:
- `apps/api/src/modules/saved-views/saved-views.module.ts`
- `apps/api/src/modules/saved-views/saved-views.service.ts`
- `apps/api/src/modules/saved-views/saved-views.controller.ts`
- `apps/api/src/modules/saved-views/dto/create-saved-view.dto.ts`
- `apps/api/src/modules/saved-views/dto/update-saved-view.dto.ts`
- `apps/api/src/modules/saved-views/dto/query-saved-views.dto.ts`

**Frontend - Components (3 files)**:
- `apps/web/src/hooks/use-custom-fields.ts`
- `apps/web/src/components/shared/custom-field-input.tsx`
- `apps/web/src/components/shared/custom-field-display.tsx`

**Screenshot scripts (2 files)**:
- `screenshots/take-screenshot.js`
- `screenshots/take-all-screenshots.js`

### Files Modified This Session
- `apps/api/src/app.module.ts` — Added CustomFieldsModule, SavedViewsModule
- `apps/api/src/main.ts` — CORS fix (multi-port array fallback)
- `apps/api/.env` — FRONTEND_URL updated to port 3002
- `apps/api/prisma/seed.ts` — Added custom fields + saved views seed data
- `apps/web/src/app/(dashboard)/settings/page.tsx` — Full rewrite for API-driven custom fields CRUD
- `apps/web/src/app/(dashboard)/candidates/page.tsx` — Custom fields in create dialog + dynamic columns
- `apps/web/src/app/(dashboard)/jobs/page.tsx` — Custom fields in create dialog + dynamic columns
- `apps/web/src/app/(dashboard)/clients/page.tsx` — Custom fields in create dialog + dynamic columns
- `apps/web/src/app/(dashboard)/candidates/[id]/page.tsx` — Custom Fields card
- `apps/web/src/app/(dashboard)/jobs/[id]/page.tsx` — Custom Fields card
- `apps/web/src/app/(dashboard)/clients/[id]/page.tsx` — Custom Fields card + _count bug fix

### Running Services
- API: `cd apps/api && node --require @swc-node/register src/main.ts` on port 3001
- Frontend: `cd apps/web && npx next dev` on port 3002

## Resume Instructions
1. Read this file first
2. Read memory: `C:\Users\E2 Training\.claude\projects\C--Outlook-Claude\memory\kurweball-progress.md`
3. Verify services: `curl http://localhost:3002` (frontend) and `curl -X POST http://localhost:3001/api/auth/login -H "Content-Type: application/json" -d '{"email":"admin@acme.com","password":"password123"}'` (API)
4. If services aren't running: API = `cd apps/api && node --require @swc-node/register src/main.ts` / Frontend = `cd apps/web && npx next dev`
5. CRITICAL: Use `node --require @swc-node/register` for API (NOT tsx — tsx v4.21+ breaks NestJS DI)
6. Sprint 6 is complete. Consider Sprint 7 or user's next request.
